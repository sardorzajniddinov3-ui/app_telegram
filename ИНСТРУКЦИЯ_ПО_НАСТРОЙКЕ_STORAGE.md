# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Supabase Storage –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤–æ–ø—Ä–æ—Å–æ–≤

## üìã –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ —Å base64 (–≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö) –Ω–∞ Supabase Storage:
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ —Ñ–∞–π–ª—ã –≤ Storage
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (—Å–∂–∞—Ç–∏–µ –¥–æ 1200px, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP)
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ CDN
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Storage Bucket

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Bucket

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://app.supabase.com)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª **Storage** –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é
4. –ù–∞–∂–º–∏—Ç–µ **"New bucket"**
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **Name**: `question-images`
   - **Public bucket**: ‚úÖ –í–∫–ª—é—á–∏—Ç–µ (—á—Ç–æ–±—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø—É–±–ª–∏—á–Ω–æ)
   - **File size limit**: `10 MB` (–∏–ª–∏ –±–æ–ª—å—à–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - **Allowed MIME types**: `image/*` (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤)
6. –ù–∞–∂–º–∏—Ç–µ **"Create bucket"**

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RLS (Row Level Security) –ø–æ–ª–∏—Ç–∏–∫

Storage –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RLS –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞. –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏:

1. –í —Ä–∞–∑–¥–µ–ª–µ **Storage** ‚Üí **Policies** –¥–ª—è bucket `question-images`
2. –°–æ–∑–¥–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏:

#### –ü–æ–ª–∏—Ç–∏–∫–∞ 1: –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –Ω–∞ —á—Ç–µ–Ω–∏–µ
```sql
-- –ù–∞–∑–≤–∞–Ω–∏–µ: Public read access
-- –û–ø–µ—Ä–∞—Ü–∏—è: SELECT
-- –ü–æ–ª–∏—Ç–∏–∫–∞:
true
```

#### –ü–æ–ª–∏—Ç–∏–∫–∞ 2: –†–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤
```sql
-- –ù–∞–∑–≤–∞–Ω–∏–µ: Allow authenticated uploads
-- –û–ø–µ—Ä–∞—Ü–∏—è: INSERT
-- –ü–æ–ª–∏—Ç–∏–∫–∞:
auth.role() = 'authenticated' OR auth.role() = 'anon'
```

#### –ü–æ–ª–∏—Ç–∏–∫–∞ 3: –†–∞–∑—Ä–µ—à–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
```sql
-- –ù–∞–∑–≤–∞–Ω–∏–µ: Allow authenticated updates
-- –û–ø–µ—Ä–∞—Ü–∏—è: UPDATE
-- –ü–æ–ª–∏—Ç–∏–∫–∞:
auth.role() = 'authenticated' OR auth.role() = 'anon'
```

#### –ü–æ–ª–∏—Ç–∏–∫–∞ 4: –†–∞–∑—Ä–µ—à–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
```sql
-- –ù–∞–∑–≤–∞–Ω–∏–µ: Allow authenticated deletes
-- –û–ø–µ—Ä–∞—Ü–∏—è: DELETE
-- –ü–æ–ª–∏—Ç–∏–∫–∞:
auth.role() = 'authenticated' OR auth.role() = 'anon'
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ SQL Editor:**

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è bucket 'question-images'
CREATE POLICY "Public read access"
ON storage.objects FOR SELECT
USING (bucket_id = 'question-images');

CREATE POLICY "Allow authenticated uploads"
ON storage.objects FOR INSERT
WITH CHECK (bucket_id = 'question-images' AND (auth.role() = 'authenticated' OR auth.role() = 'anon'));

CREATE POLICY "Allow authenticated updates"
ON storage.objects FOR UPDATE
USING (bucket_id = 'question-images' AND (auth.role() = 'authenticated' OR auth.role() = 'anon'));

CREATE POLICY "Allow authenticated deletes"
ON storage.objects FOR DELETE
USING (bucket_id = 'question-images' AND (auth.role() = 'authenticated' OR auth.role() = 'anon'));
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –≤ Storage

–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É –ø—É—Ç–∏:
```
question-images/
  ‚îî‚îÄ‚îÄ questions/
      ‚îú‚îÄ‚îÄ {question-id}.webp  (–¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤)
      ‚îî‚îÄ‚îÄ {timestamp}-{random}.webp  (–¥–ª—è –Ω–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤)
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã —Å base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏, –æ–Ω–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –ù–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ Storage.

–î–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π:
1. –ß–∏—Ç–∞–µ—Ç –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã —Å base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
2. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç base64 –≤ —Ñ–∞–π–ª
3. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤ Storage
4. –û–±–Ω–æ–≤–ª—è–µ—Ç `image_url` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤**: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç—Å—è –¥–æ 1200px –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ WebP
2. **–°—Ç–∞—Ä—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: Base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –Ω–æ–≤—ã–µ –±—É–¥—É—Ç –≤ Storage
3. **–£–¥–∞–ª–µ–Ω–∏–µ**: –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–∞ —Å—Ç–∞—Ä—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ Storage
4. **–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø**: Bucket –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "Bucket not found"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ bucket —Å–æ–∑–¥–∞–Ω —Å –∏–º–µ–Ω–µ–º `question-images`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ bucket –ø—É–±–ª–∏—á–Ω—ã–π

### –û—à–∏–±–∫–∞ "Access denied"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É bucket

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ bucket –ø—É–±–ª–∏—á–Ω—ã–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–æ–±—ã—á–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

- ‚úÖ **–ú–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î
- ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞**: CDN Supabase —É—Å–∫–æ—Ä—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∂–∏–º–∞—é—Ç—Å—è –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ WebP
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –±–æ–ª—å—à–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–Ω—å—à–µ –ø–æ —Ä–∞–∑–º–µ—Ä—É
