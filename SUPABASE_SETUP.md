# üóÑÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase –¥–ª—è Telegram Mini App

## –®–∞–≥ 1: –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü—ã `profiles`

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ `profiles` —Å –ø–æ–ª—è–º–∏: `id` (int8), `username`, `first_name`, `is_premium`, `premium_until`, `created_at`, —Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `phone`:

–í Supabase Dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π SQL:

```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è phone –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É profiles
ALTER TABLE profiles 
ADD COLUMN IF NOT EXISTS phone TEXT;

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
CREATE INDEX IF NOT EXISTS idx_profiles_id ON profiles(id);
CREATE INDEX IF NOT EXISTS idx_profiles_created_at ON profiles(created_at DESC);

-- –í–∫–ª—é—á–µ–Ω–∏–µ Row Level Security (RLS) –µ—Å–ª–∏ –µ—â–µ –Ω–µ –≤–∫–ª—é—á–µ–Ω–æ
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –≤—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å (–¥–ª—è –∞–¥–º–∏–Ω–∫–∏) - —Å–æ–∑–¥–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
DO $$
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM pg_policies 
    WHERE tablename = 'profiles' 
    AND policyname = 'Anyone can read profiles'
  ) THEN
    CREATE POLICY "Anyone can read profiles" ON profiles
      FOR SELECT
      USING (true);
  END IF;
END $$;

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –≤—Å–µ –º–æ–≥—É—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å/–æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ - —Å–æ–∑–¥–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
DO $$
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM pg_policies 
    WHERE tablename = 'profiles' 
    AND policyname = 'Anyone can insert/update profiles'
  ) THEN
    CREATE POLICY "Anyone can insert/update profiles" ON profiles
      FOR ALL
      USING (true)
      WITH CHECK (true);
  END IF;
END $$;
```

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–Ω–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Supabase –≤–º–µ—Å—Ç–æ localStorage.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

–¢–∞–±–ª–∏—Ü–∞ `profiles` —Å–æ–¥–µ—Ä–∂–∏—Ç:
- `id` (TEXT, PRIMARY KEY) - Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `first_name` (TEXT) - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `phone` (TEXT) - –¢–µ–ª–µ—Ñ–æ–Ω –∏–∑ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `telegram_username` (TEXT, nullable) - Username –∏–∑ Telegram
- `created_at` (TIMESTAMPTZ) - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
- `updated_at` (TIMESTAMPTZ) - –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: –¢–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Supabase —á–µ—Ä–µ–∑ `upsert`
‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Supabase (–ª–æ–≥–∏–∫–∞ "–æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞")
‚úÖ **–ê–¥–º–∏–Ω–∫–∞**: –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Supabase –≤–º–µ—Å—Ç–æ localStorage
‚úÖ **–í—Å–µ —Å—Ç–∏–ª–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd web
npm install
```

–≠—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç `@supabase/supabase-js` –ø–∞–∫–µ—Ç.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
3. –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase
4. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
5. –í –∞–¥–º–∏–Ω–∫–µ (ID: 473842863) –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–∑ Supabase

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∞–¥–º–∏–Ω–∫–µ

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** (F12 ‚Üí Console)
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏: "–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Supabase..." –∏ "–ü–æ–ª—É—á–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Supabase: X"

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É –≤ Supabase Dashboard**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Table Editor ‚Üí `profiles`
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª—è: id, first_name, phone, telegram_username, created_at, updated_at)

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Authentication ‚Üí Policies
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∞ "Anyone can read profiles" –∞–∫—Ç–∏–≤–Ω–∞
   - –ï—Å–ª–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ –®–∞–≥–∞ 1

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase**
   - –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ "Failed to fetch" –∏–ª–∏ "Network error"
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –∏ Anon Key –≤ `supabase.js` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "‚Üª –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫"**
   - –í –∞–¥–º–∏–Ω–∫–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Supabase

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
SELECT * FROM profiles ORDER BY created_at DESC;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT COUNT(*) FROM profiles;
```
