# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—ä—è—Å–Ω–µ–Ω–∏–π –ò–ò

## –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç?

–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—Ç—å –ª–∏–º–∏—Ç—ã API** - –Ω–µ –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ Gemini API –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- ‚úÖ **–£—Å–∫–æ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç—ã** - –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –∏–∑ –±–∞–∑—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- ‚úÖ **–°–Ω–∏–∑–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å** - –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ø–ª–∞—Ç–Ω–æ–º—É API

## –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard**: https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
4. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `SUPABASE_AI_CACHE_TABLE.sql` –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å SQL –∫–æ–¥ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –≤ SQL Editor
6. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ F5)

–¢–∞–±–ª–∏—Ü–∞ `ai_explanations` –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —Å:
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º –ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ `question + wrong_answer + correct_answer`
- RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º `updated_at`

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ **Supabase Dashboard** ‚Üí **Project Settings** ‚Üí **Edge Functions** ‚Üí **Secrets** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

- ‚úÖ `SUPABASE_URL` - URL –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://xxxxx.supabase.co`)
- ‚úÖ `SUPABASE_ANON_KEY` - Anon –∫–ª—é—á (–ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á)
- ‚úÖ `GEMINI_API_KEY` - –ö–ª—é—á API –¥–ª—è Gemini

**–í–∞–∂–Ω–æ:** `SUPABASE_URL` –∏ `SUPABASE_ANON_KEY` –æ–±—ã—á–Ω–æ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Ö –Ω–∞–ª–∏—á–∏–µ.

## –®–∞–≥ 3: –î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

```bash
cd apptg111/apptg/telegram-mini-app
supabase functions deploy explain-answer
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Supabase Dashboard:
- –û—Ç–∫—Ä–æ–π—Ç–µ **Edge Functions** ‚Üí **explain-answer**
- –ù–∞–∂–º–∏—Ç–µ **Deploy** –∏–ª–∏ **Redeploy**

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. **–ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
   - –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—ç—à ‚Üí –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç
   - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —É Gemini API
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–≤–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

2. **–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ—Ç –∂–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ —Ç–æ—Ç –∂–µ –≤–æ–ø—Ä–æ—Å
   - –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—ç—à ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** (–±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –∫ API)

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç
2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å
3. –ù–∞–∂–º–∏—Ç–µ "–û–±—ä—è—Å–Ω–∏—Ç—å"
4. –í –∫–æ–Ω—Å–æ–ª–∏ Supabase Edge Functions –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
   - `‚ÑπÔ∏è –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∫—ç—à–µ, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É –ò–ò` (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
   - `‚úÖ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∫—ç—à`
   - `‚úÖ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∫—ç—à–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∑ –±–∞–∑—ã` (–≤—Ç–æ—Ä–æ–π —Ä–∞–∑)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫—ç—à–∞

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π:

```sql
SELECT COUNT(*) FROM ai_explanations;
```

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è:

```sql
SELECT question, wrong_answer, correct_answer, explanation, created_at 
FROM ai_explanations 
ORDER BY created_at DESC 
LIMIT 10;
```

## –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏:

```sql
-- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
DELETE FROM ai_explanations 
WHERE created_at < NOW() - INTERVAL '30 days';
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `ai_explanations` —Å–æ–∑–¥–∞–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ (–¥–æ–ª–∂–Ω—ã —Ä–∞–∑—Ä–µ—à–∞—Ç—å INSERT)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function –≤ Supabase Dashboard

### –ü—Ä–æ–±–ª–µ–º–∞: "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫—ç—à–∞"

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `SUPABASE_URL` –∏ `SUPABASE_ANON_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ Secrets
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω–∞

### –ü—Ä–æ–±–ª–µ–º–∞: "–î—É–±–ª–∏–∫–∞—Ç—ã –≤ –∫—ç—à–µ"

**–†–µ—à–µ–Ω–∏–µ:**
–¢–∞–±–ª–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `UNIQUE(question, wrong_answer, correct_answer)`, –ø–æ—ç—Ç–æ–º—É –¥—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - `upsert` –æ–±–Ω–æ–≤–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å.

---

‚úÖ **–ì–æ—Ç–æ–≤–æ!** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
