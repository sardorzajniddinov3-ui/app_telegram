# üöÄ –î–µ–ø–ª–æ–π Edge Function –¥–ª—è –ò–ò-—Ç—Ä–µ–Ω–µ—Ä–∞

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
–ö–æ–º–∞–Ω–¥–∞ `supabase` –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - Supabase CLI –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: 2 —Å–ø–æ—Å–æ–±–∞

---

## üì¶ –°–ø–æ—Å–æ–± 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Supabase CLI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –î–ª—è Windows (PowerShell):

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Scoop (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Scoop)
scoop bucket add supabase https://github.com/supabase/scoop-bucket.git
scoop install supabase

# –ò–õ–ò —á–µ—Ä–µ–∑ npm (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Node.js)
npm install -g supabase
```

### –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
supabase --version

# –õ–æ–≥–∏–Ω –≤ Supabase
supabase login

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–ø–∫—É —Å –ø—Ä–æ–µ–∫—Ç–æ–º
cd D:\apptg\apptg111\apptg111\apptg\telegram-mini-app

# –î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
supabase functions deploy ai-trainer-advice --project-ref YOUR_PROJECT_REF
```

**–ì–¥–µ –≤–∑—è—Ç—å PROJECT_REF:**
- –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
- Settings ‚Üí API
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ "Reference ID" (–≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ `abcdefghijklmnop`)

---

## üåê –°–ø–æ—Å–æ–± 2: –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Supabase Dashboard (–ø—Ä–æ—â–µ)

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É: `supabase/functions/ai-trainer-advice/`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–º –µ—Å—Ç—å —Ñ–∞–π–ª `index.ts`

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard**
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Edge Functions** (–≤ –ª–µ–≤–æ–º –º–µ–Ω—é)
3. –ù–∞–∂–º–∏—Ç–µ **Create a new function**
4. –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏: `ai-trainer-advice`
5. –ù–∞–∂–º–∏—Ç–µ **Create function**

### –®–∞–≥ 3: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `supabase/functions/ai-trainer-advice/index.ts`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å –∫–æ–¥** –∏–∑ —Ñ–∞–π–ª–∞
3. –í Dashboard –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥
4. –ù–∞–∂–º–∏—Ç–µ **Deploy**

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –í Dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Edge Functions** ‚Üí **ai-trainer-advice**
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É **Settings**
3. –í —Ä–∞–∑–¥–µ–ª–µ **Secrets** –¥–æ–±–∞–≤—å—Ç–µ:
   - **Name:** `GEMINI_API_KEY`
   - **Value:** –≤–∞—à –∫–ª—é—á Google Gemini API
4. –ù–∞–∂–º–∏—Ç–µ **Save**

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –í Dashboard –æ—Ç–∫—Ä–æ–π—Ç–µ **Edge Functions** ‚Üí **ai-trainer-advice**
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Logs**
3. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é:

### –ß–µ—Ä–µ–∑ Dashboard:

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Edge Functions** ‚Üí **ai-trainer-advice**
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Invoke**
3. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π JSON:

```json
{
  "userId": 123456789,
  "errors": [
    {
      "question": "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∑–Ω–∞–∫ 'STOP'?",
      "wrong": "–£—Å—Ç—É–ø–∏ –¥–æ—Ä–æ–≥—É",
      "correct": "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞"
    }
  ],
  "correctCount": 15,
  "totalCount": 20
}
```

4. –ù–∞–∂–º–∏—Ç–µ **Invoke**
5. –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON —Å –ø–æ–ª–µ–º `advice`

### –ß–µ—Ä–µ–∑ –∫–æ–¥ (–≤ –±—Ä–∞—É–∑–µ—Ä–µ):

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ –≤ –∫–æ–¥–µ
const { data, error } = await supabase.functions.invoke('ai-trainer-advice', {
  body: {
    userId: 123456789,
    errors: [],
    correctCount: 20,
    totalCount: 20
  }
});

console.log(data); // { advice: "..." }
```

---

## ‚ö†Ô∏è Troubleshooting

### –û—à–∏–±–∫–∞: "Function not found"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `ai-trainer-advice`)

### –û—à–∏–±–∫–∞: "GEMINI_API_KEY not found"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ Settings ‚Üí Secrets
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞

### –û—à–∏–±–∫–∞: "429 Rate Limit"
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Dashboard

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å **–®–∞–≥–∞ 3** –∏–∑ `AI_TRAINER_IMPLEMENTATION_GUIDE.md` (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥).
